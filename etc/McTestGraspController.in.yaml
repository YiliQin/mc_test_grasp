---
# If true, the FSM transitions are managed by an external tool
Managed: false
# If true and the FSM is self-managed, transitions should be triggered
StepByStep: true
# Change idle behaviour, if true the state is kept until transition,
# otherwise the FSM holds the last state until transition
IdleKeepState: false
# Where to look for state libraries
StatesLibraries:
- "@MC_STATES_DEFAULT_RUNTIME_INSTALL_PREFIX@"
- "@MC_STATES_RUNTIME_INSTALL_PREFIX@"
# Where to look for state files
StatesFiles:
- "@MC_STATES_DEFAULT_RUNTIME_INSTALL_PREFIX@/data"
- "@MC_STATES_RUNTIME_INSTALL_PREFIX@/data"
# If true, state factory will be more verbose
VerboseStateFactory: false
# Additional robots to load
robots:
  ground:
    module: env/ground
# General constraints, always on
constraints:
- type: contact
- type: dynamics
  damper: [0.1, 0.01, 0.5]
- type: compoundJoint
# Collision constraint
collisions:
- type: collision
  useMinimal: true
  collisions:
    - body1: LARM_*
      body2: RARM_*
      iDist: 0.05
      sDist: 0.01
    - body1: LARM_*
      body2: RHAND_*
      iDist: 0.05
      sDist: 0.01
    - body1: LHAND_*
      body2: RARM_*
      iDist: 0.05
      sDist: 0.01
    - body1: LHAND_*
      body2: RHAND_*
      iDist: 0.05
      sDist: 0.01
# Initial set of contacts
contacts:
- r1: hrp2_drc
  r2: ground
  r1Surface: LFullSole
  r2Surface: AllGround
- r1: hrp2_drc
  r2: ground
  r1Surface: RFullSole
  r2Surface: AllGround

# Some options for a specific robot
hrp2_drc:
  posture:
    stiffness: 1
    weight: 10
  ff:
    stiffness: 2
    weight: 100

# Implement some additional text states
states: {}

# Transitions map
transitions:
  # manual mode
  #- [ZeroGraspStep, AddedLeft, CloseLeftGripperStep, Auto]
  - [McTestGraspController_Initial, ManualMode, ZeroGraspStep, Auto]
  - [ZeroGraspStep, AddedLeft, OneGraspLeftHoldStep, Auto]
  - [OneGraspLeftHoldStep, AddedHand, TwoGraspStep, Auto]
  - [OneGraspLeftHoldStep, ReqRemove, RemoveLeftFromOneStep, Auto]
  - [RemoveLeftFromOneStep, RemovedLeft, ZeroGraspStep, Auto]
  - [TwoGraspStep, ReqRemoveLeft, RemoveLeftFromTwoStep, Auto]
  - [RemoveLeftFromTwoStep, RemovedLeft, OneGraspRightHoldStep, Auto]

  - [ZeroGraspStep, AddedRight, OneGraspRightHoldStep, Auto]
  - [OneGraspRightHoldStep, AddedHand, TwoGraspStep, Auto]
  - [OneGraspRightHoldStep, ReqRemove, RemoveRightFromOneStep, Auto]
  - [RemoveRightFromOneStep, RemovedRight, ZeroGraspStep, Auto]
  - [TwoGraspStep, ReqRemoveRight, RemoveRightFromTwoStep, Auto]
  - [RemoveRightFromTwoStep, RemovedRight, OneGraspLeftHoldStep, Auto]

    #  # auto mode
    #  - [McTestGraspController_Initial, AutoMode, S0::ZeroGrasp::AddRight, Auto] 
    #  - [S0::ZeroGrasp::AddRight, AddedRight, S1::CloseRightGripper, Strict] 
    #  - [S1::CloseRightGripper, OK, S2::OneGrasp::MoveRight, Auto] 
    #    # theta = 90
    #  - [S2::OneGrasp::MoveRight, MovedOK, S3::OneGrasp::AddLeftRelative, Auto] 
    #  - [S3::OneGrasp::AddLeftRelative, AddedHand, S4::CloseLeftGripper, Auto] 
    #  - [S4::CloseLeftGripper, OK, S5::OpenLeftGripper, Strict] 
    #  - [S5::OpenLeftGripper, OK, S6::TwoGrasp::ReqRemoveLeft, Auto] 
    #  - [S6::TwoGrasp::ReqRemoveLeft, ReqRemoveLeft, S7::TwoGrasp::RemoveLeft, Auto] 
    #  - [S7::TwoGrasp::RemoveLeft, RemovedLeft, S8::OneGrasp::MoveRight, Auto] 
    #    # theta = 45
    #  - [S8::OneGrasp::MoveRight, MovedOK, S9::OneGrasp::AddLeftRelative, Auto] 
    #  - [S9::OneGrasp::AddLeftRelative, AddedHand, S10::CloseLeftGripper, Auto] 
    #  - [S10::CloseLeftGripper, OK, S11::OpenLeftGripper, Strict] 
    #  - [S11::OpenLeftGripper, OK, S12::TwoGrasp::ReqRemoveLeft, Auto] 
    #  - [S12::TwoGrasp::ReqRemoveLeft, ReqRemoveLeft, S13::TwoGrasp::RemoveLeft, Auto] 
    #  - [S13::TwoGrasp::RemoveLeft, RemovedLeft, S14::OneGrasp::MoveRight, Auto] 
    #    # theta = 0
    #  - [S14::OneGrasp::MoveRight, MovedOK, S15::OneGrasp::AddLeftRelative, Auto] 
    #  - [S15::OneGrasp::AddLeftRelative, AddedHand, S16::CloseLeftGripper, Auto] 
    #  - [S16::CloseLeftGripper, OK, S17::OpenLeftGripper, Strict] 
    #  - [S17::OpenLeftGripper, OK, S18::TwoGrasp::ReqRemoveLeft, Auto] 
    #  - [S18::TwoGrasp::ReqRemoveLeft, ReqRemoveLeft, S19::TwoGrasp::RemoveLeft, Auto] 
    #  - [S19::TwoGrasp::RemoveLeft, RemovedLeft, S20::OneGrasp::MoveRight, Auto] 
    #    # theta = -45
    #  - [S20::OneGrasp::MoveRight, MovedOK, S21::OneGrasp::AddLeftRelative, Auto] 
    #  - [S21::OneGrasp::AddLeftRelative, AddedHand, S22::CloseLeftGripper, Auto] 
    #  - [S22::CloseLeftGripper, OK, S23::OpenLeftGripper, Strict] 
    #  - [S23::OpenLeftGripper, OK, S24::TwoGrasp::ReqRemoveLeft, Auto] 
    #  - [S24::TwoGrasp::ReqRemoveLeft, ReqRemoveLeft, S25::TwoGrasp::RemoveLeft, Auto] 
    #  - [S25::TwoGrasp::RemoveLeft, RemovedLeft, S26::OneGrasp::MoveRight, Auto] 
    #    # theta = -90
    #  - [S26::OneGrasp::MoveRight, MovedOK, S27::OneGrasp::AddLeftRelative, Auto] 
    #  - [S27::OneGrasp::AddLeftRelative, AddedHand, S28::CloseLeftGripper, Auto] 
    #  - [S28::CloseLeftGripper, OK, S29::OpenLeftGripper, Strict] 
    #  - [S29::OpenLeftGripper, OK, S30::TwoGrasp::ReqRemoveLeft, Auto] 
    #  - [S30::TwoGrasp::ReqRemoveLeft, ReqRemoveLeft, S31::TwoGrasp::RemoveLeft, Auto] 
    #    # manual open gripper and finish
    #  - [S31::TwoGrasp::RemoveLeft, RemovedLeft, S32::OneGrasp::RemoveRight, Strict] 

  #  assemble belt 
  - [McTestGraspController_Initial, AutoMode, Asmb_s0::ZeroGrasp::AddRight, Auto] 
  - [Asmb_s0::ZeroGrasp::AddRight, AddedRight, Asmb_s1::CloseRightGripper, Strict] 
  - [Asmb_s1::CloseRightGripper, OK, Asmb_s2::OneGrasp::MoveRight, Strict] 
  - [Asmb_s2::OneGrasp::MoveRight, MovedOK, Asmb_s3::OneGrasp::MoveRight, Strict] 
  - [Asmb_s3::OneGrasp::MoveRight, MovedOK, Asmb_s4::OneGrasp::AddLeftRelative, Strict] 
  - [Asmb_s4::OneGrasp::AddLeftRelative, AddedHand, Asmb_s5::CloseLeftGripper, Strict] 
  - [Asmb_s5::CloseLeftGripper, OK, Asmb_s6::OpenRightGripper, Strict] 
  - [Asmb_s6::OpenRightGripper, OK, Asmb_s7::TwoGrasp::ReqRemoveRight, Strict] 
  - [Asmb_s7::TwoGrasp::ReqRemoveRight, ReqRemoveRight, Asmb_s8::TwoGrasp::RemoveRight, Auto] 
  - [Asmb_s8::TwoGrasp::RemoveRight, RemovedRight, Asmb_s9::OneGrasp::MoveLeft, Strict] 
  - [Asmb_s9::OneGrasp::MoveLeft, MovedOK, Asmb_s10::OneGrasp::AddRightRelative, Strict] 
  - [Asmb_s10::OneGrasp::AddRightRelative, AddedHand, Asmb_s11::CloseRightGripper, Strict] 
  - [Asmb_s11::CloseRightGripper, OK, Asmb_s12::OpenLeftGripper, Strict] 
  - [Asmb_s12::OpenLeftGripper, OK, Asmb_s13::TwoGrasp::ReqRemoveLeft, Strict] 
  - [Asmb_s13::TwoGrasp::ReqRemoveLeft, ReqRemoveLeft, Asmb_s14::TwoGrasp::RemoveLeft, Auto] 
  - [Asmb_s14::TwoGrasp::RemoveLeft, RemovedLeft, Asmb_s15::OneGrasp::MoveRight, Strict] 
  - [Asmb_s15::OneGrasp::MoveRight, MovedOK, Asmb_s16::OneGrasp::MoveRight, Strict] 
  #- [Asmb_s16::OneGrasp::MoveRight, MovedOK, Asmb_s17::OneGrasp::AddLeftRelative, Strict] 
  #- [Asmb_s17::OneGrasp::AddLeftRelative, AddedHand, Asmb_s18::CloseLeftGripper, Strict] 
  - [Asmb_s16::OneGrasp::MoveRight, MovedOK, Asmb_s17::OneGrasp::AddLeft, Strict] 
  - [Asmb_s17::OneGrasp::AddLeft, AddedHand, Asmb_s18::CloseLeftGripper, Strict] 
  - [Asmb_s18::CloseLeftGripper, OK, Asmb_s19::OpenRightGripper, Strict] 
  - [Asmb_s19::OpenRightGripper, OK, Asmb_s20::TwoGrasp::ReqRemoveRight, Strict] 
  - [Asmb_s20::TwoGrasp::ReqRemoveRight, ReqRemoveRight, Asmb_s21::TwoGrasp::RemoveRight, Auto] 
  - [Asmb_s21::TwoGrasp::RemoveRight, RemovedRight, Asmb_s22::OneGrasp::MoveLeft, Strict] 
  - [Asmb_s22::OneGrasp::MoveLeft, MovedOK, Asmb_s23::OpenLeftGripper, Strict] 
  - [Asmb_s23::OpenLeftGripper, OK, Asmb_s24::TwoGrasp::ReqRemoveLeft, Strict] 
  - [Asmb_s24::TwoGrasp::ReqRemoveLeft, ReqRemoveLeft, Asmb_s25::TwoGrasp::RemoveLeft, Auto] 

# Initial state
## manual mode
#init: ZeroGraspStep
## auto mode
init: McTestGraspController_Initial

# auto mode or manual mode
#auto_mode: true

#CoMTask:
  #type: com
  #weight: 1000
  #dimWeight: [1.0, 1.0, 0.3]
  #stiffness: [50.0, 50.0, 5.0]
  ##com: [0.0, 0.0, 0.85]
  #activeJoints: [Root, RLEG_JOINT0, RLEG_JOINT1, RLEG_JOINT2, RLEG_JOINT3, RLEG_JOINT4, RLEG_JOINT5, LLEG_JOINT0, LLEG_JOINT1, LLEG_JOINT2, LLEG_JOINT3, LLEG_JOINT4, LLEG_JOINT5]

#BodyOrientationTask:
  #type: orientation
  #body: BODY
  #weight: 500
  #stiffness: 5.0

#ChestOrientationTask:
  #type: orientation
  #body: CHEST_LINK1
  #weight: 100
  #stiffness: 2.0

StabilizerTask:
  type: lipm_stabilizer
  contacts: [Left, Right]
  admittance:
    cop: [0.004, 0.004]
    maxVel:
      angular: [3.0, 3.0, 3.0]
      linear: [0.5, 0.5, 0.5]
  dcm_tracking:
    gains:
      prop: 3.0
      integral: 20.0
      deriv: 0.5
      comdError: 1.0
      zmpd: 0.1
  dcm_bias:
    biasDriftPerSecondStd: 0.0001
    withDCMBias: true
  tasks:
    com:
      stiffness: [1000, 1000, 300]
      weight: 1000
      dimWeight: [1.0, 1.0, 0.3]
    torso:
      #stiffness: 300
      stiffness: 50.0
      weight: 200
    pelvis:
      stiffness: 300
      #stiffness: 50
      weight: 200

LookAtHandTask:
  type: lookAt
  body: azure_depth_frame
  bodyVector: [0.0, 0.0, 0.0]
  targetPos: [1.0, 0.0, 1.2]
  weight: 100
  stiffness: 1.0
  activeJoints: [HEAD_JOINT0, HEAD_JOINT1]

LeftHandTask:
  type: bspline_trajectory 
  surface: LeftGripper
  weight: 200
  stiffness: 100.0
  duration: 10.0
  dimWeight: [1.0, 1.0, 1.0, 1.0, 1.0, 1.0]
  displaySamples: 20
  activeJoints: [LARM_JOINT0, LARM_JOINT1, LARM_JOINT2, LARM_JOINT3, LARM_JOINT4, LARM_JOINT5, LARM_JOINT6, LARM_JOINT7]
  completion:
    OR:
      - timeElapsed: true
  target:
    translation: [0.0, 0.0, 0.0]
    rotation: [0.0, 0.0, 0.0]
  controlPoints:
  [
  ]
  oriWaypoints:
  [
  ]

RightHandTask:
  type: bspline_trajectory 
  surface: RightGripper
  weight: 200
  stiffness: 100.0
  duration: 10.0
  dimWeight: [1.0, 1.0, 1.0, 1.0, 1.0, 1.0]
  displaySamples: 20
  activeJoints: [RARM_JOINT0, RARM_JOINT1, RARM_JOINT2, RARM_JOINT3, RARM_JOINT4, RARM_JOINT5, RARM_JOINT6, RARM_JOINT7]
  completion:
    OR:
      - timeElapsed: true
  target:
    translation: [0.0, 0.0, 0.0]
    rotation: [0.0, 0.0, 0.0]
  controlPoints:
  [
  ]
  oriWaypoints:
  [
  ]

